digraph {
  rankdir = LR
  nodesep = .25
  ranksep = .5
  splines = ortho

  # nodes ------------------------------------------------------------------------------------------

  {
    node [
      shape = "point"
      margin = 0
      peripheries = 2
      penwidth = 4
      width = 0.1
      height = 0.1
      label = ""
    ]
    { rank=min start }
    { rank=max end }
  }

  {
    node [
      style="filled"
      color = "#000000"
      fillcolor = "#fbf8f8"
      penwidth = 1
      height = 1
      fixedsize=1
      width = 2
      margin = 0
      fontsize = 12
    ]

    {
      rank = same
      node [
        shape = diamond
        width = 3.5
        fontname = "Courier"
      ]
      is_config_force   [ label = "is\n<config.force>\nset?" ]
      is_a_tty          [ label = "is output\npiped or\nredirected?" ]
      is_true           [
        label = "TERM = xterm-256color &&\nCOLORTERM &isin; [truecolor,24bit]?"
        fontsize = 10
      ]
      is_256            [ label = "TERM &asymp; *-256color" ]
      is_16             [ label = "TERM = xterm-color" ]
      is_xterm          [ label = "TERM = xterm" ]
    }

    {
      rank = same
      node [
        shape = box
        width = 1.8
        fontname = "Courier"
      ]
      set_config_force  [label = "set from\n<config.force>"]
      set_no_ansi       [label = "set NO_ANSI"]
      set_true_color    [label = "set TRUE_COLOR"]
      set_256           [label = "set XTERM_256"]
      set_16            [label = "set XTERM_16"]
      set_no_ansi_2     [label = "set NO_ANSI"]
      set_config_default [label = "set from\n<config.default>"]
    }
  }

  # START/END edges ------------------------------------------------------------------------------------------

  {
    edge [
      fontname = "Arial"
      fontsize = 12
      minlen = 2
      labeldistance = 4
      labelangle = 180
    ]
    start -> is_config_force [ taillabel = "START" ]
    set_config_default -> end [ headlabel = "END" ]


    edge [
      constraint = 0
      arrowsize = 0.5
    ]
    set_config_force -> end
    set_no_ansi -> end
    set_true_color -> end
    set_256 -> end
    set_16 -> end
    set_no_ansi_2 -> end

  }

  # YES/NO edges ------------------------------------------------------------------------------------------

  {
    edge [
      minlen = 1
      fontname = "sans-serif"
      fontsize = 12
      labelangle = 75
      penwidth = 1.5
    ]

    edge [
      fillcolor = green
      color = darkgreen
      fontcolor = darkgreen
    ]
    edge [ taillabel = "yes" ]
    is_config_force -> set_config_force
    is_a_tty -> set_no_ansi
    edge [ taillabel = "true" ]
    is_true -> set_true_color
    is_256 -> set_256
    is_16 -> set_16
    is_xterm -> set_no_ansi_2

    edge [
      fillcolor = red
      color = darkred
      labeldistance = 2.5
      fontcolor = darkred
    ]
    edge [ taillabel = "no" ]
    is_config_force -> is_a_tty
    is_a_tty -> is_true
    edge [ taillabel = "false" ]
    is_true -> is_256
    is_256 -> is_16
    is_16 -> is_xterm
    is_xterm -> set_config_default

  }
}
